#!/bin/bash
# ==============================================================================
# カレントディレクトリ以下の全ファイルを復元不可能な形で完全に削除するスクリプト。
# shredコマンドを使用する。実行には細心の注意を払うこと。
# UTF-8で保存すること。
# ==============================================================================

# --- ヘルプ表示 ---
show_help() {
  cat << EOF
使い方: $(basename "$0") [-h|--help]

【警告】これは非常に危険なスクリプトじゃ！
カレントディレクトリ、及びその全てのサブディレクトリに含まれる「ファイル」を、
復元不可能な方法で完全に削除する。ディレクトリ構造は残るぞ。

■ 処理内容:
  1. shredコマンドでファイルの内容をランダムなデータで複数回上書きする。
  2. ファイルサイズを0にする。
  3. 最後にファイルを削除する。

この処理は元に戻せん。実行する前に、自分が何をしているか完全に理解することじゃ。

■ オプション:
  -h, --help     このヘルプメッセージを表示する。
EOF
}

# --- 引数解析 ---
if [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
    show_help
    exit 0
fi

# --- スクリプト本体 ---
# 警告メッセージと削除対象ファイルのリストを表示する
echo "【警告】以下のファイルが復元不可能な形で完全に削除されるのじゃ。" >&2
echo "--------------------------------------------------" >&2
find . -type f
echo "--------------------------------------------------" >&2
echo "対象ディレクトリ: $(pwd)" >&2
echo "" >&2

# ユーザーに実行の最終確認を求める
read -p "本当にこれらのファイルを削除してよいか？ (yesと入力): " answer

# 入力が 'yes' の場合のみ、shredコマンドを実行する
if [[ "${answer}" == "yes" ]]; then
    echo "承知した。ファイルの完全削除を開始する…。"
    # -print0 と xargs -0 を使い、特殊文字を含むファイル名にも対応
    find . -type f -print0 | xargs -0 shred -uvz
    echo "処理が完了したぞ。"
else
    echo "処理を中断した。賢明な判断じゃ。"
fi

